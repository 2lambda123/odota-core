extend layout

block head
    script(type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js')
    script(type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.2/moment.min.js')
    script(type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.js')
    script(type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/vis/3.5.0/vis.js')
    script(type='text/javascript' src='https://code.jquery.com/jquery-2.1.1.min.js')
    script(type='text/javascript' src='//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js')
    link(rel='stylesheet', href='//cdnjs.cloudflare.com/ajax/libs/c3/0.1.29/c3.css')
    link(rel='stylesheet', href='//cdnjs.cloudflare.com/ajax/libs/vis/3.5.0/vis.css')
    link(rel='stylesheet', href='../public/css/match.css')

    script.
     var match = !{JSON.stringify(match)}
     var constants = !{JSON.stringify(constants)}
    style.
     .hero img {width: 50px;}
     .items {white-space:nowrap;}
     .items img {width: 35px;}
     
block content
        h1 Match #{match.match_id}
        .row
          .col-md-6
          .col-md-6
            table.table.table-condensed
              tr
                td Duration
                td Game Mode
              tr
                td= moment().startOf('day').seconds(match.duration).format("H:mm:ss")
                td= constants.modes[match.game_mode].name
        .row
          .col-md-12
            h1(class = match.radiant_win ? "success" : "danger").text-center= match.radiant_win ? "Radiant Victory" : "Dire Victory"
            table.table.table-hover.table-responsive
                  tr
                    th Player
                    th Hero
                    th LV
                    th K
                    th D
                    th A
                    th LH
                    th DN
                    th G
                    th GPM
                    th XPM
                    th HD
                    th TD
                    th HH
                    th Items
                    if match.parsed_data
                      th TP
                      th OBS
                      th SEN
                      th SMK
                      th DST
                  - each player, i in match.players
                   tr(class = i < 5 ? "success" : "danger")
                     td
                       if (player.account_id == constants.anonymous_account_id)
                         ="Anonymous"
                       else
                         a(href='/players/#{player.account_id}')=player.display_name ? player.display_name : player.account_id
                     - var hero = constants.heroes[player.hero_id]
                     td.hero: img(src=hero.img, alt=hero.localized_name)
                     td= player.level
                     td= player.kills
                     td= player.deaths
                     td= player.assists
                     td= player.last_hits
                     td= player.denies
                     td= numeral(player.gold+player.gold_spent).format('0.0a')
                     td= player.gold_per_min
                     td= player.xp_per_min
                     td= numeral(player.hero_damage).format('0.0a')
                     td= numeral(player.tower_damage).format('0.0a')
                     td= numeral(player.hero_healing).format('0.0a')
                     td.items
                       each val, index in player
                         if (index.slice(0, 5)==="item_")
                           - var item = constants.items[constants.item_ids[val]]
                           if item
                             img(src=item.img, alt=item.dname)
                         if (player.hero_id === 80)
                           each val, index in player.additional_units[0]
                             - var item = constants.items[constants.item_ids[val]]
                             if item
                               img(src=item.img, alt=item.dname)
                     if match.parsed_data
                       td #{match.parsed_data.players[i].itemuses.tpscroll || "-"}
                       td #{match.parsed_data.players[i].itemuses.ward_observer || "-"}
                       td #{match.parsed_data.players[i].itemuses.ward_sentry || "-"}
                       td #{match.parsed_data.players[i].itemuses.smoke_of_deceit || "-"}
                       td #{match.parsed_data.players[i].itemuses.dust || "-"}

        if match.parsed_data
          .row
            h3 Radiant Advantage
            #chart-diff
            h3 Gold           
            #chart-gold
            h3 XP            
            #chart-xp
            h3 LH
            #chart-lh
            script(type='text/javascript', src='../public/js/chart.js')
            #chart-timeline
            script(type='text/javascript', src='../public/js/timeline.js')
